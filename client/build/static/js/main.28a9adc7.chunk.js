(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{186:function(e,t){},188:function(e,t){},202:function(e,t){},204:function(e,t){},232:function(e,t){},234:function(e,t){},235:function(e,t){},240:function(e,t){},242:function(e,t){},261:function(e,t){},273:function(e,t){},276:function(e,t){},324:function(e,t,n){"use strict";n.r(t);var o=n(1),c=n(0),r=n.n(c),a=n(31),s=n.n(a),i=n(43),l=n(9),u=n(23),d=n(54),j=n(32),m=n(13),b=n(172),f=n.n(b),h=Object(c.createContext)({}),p=function(e){var t=e.children,n=Object(c.useState)({}),r=Object(m.a)(n,2),a=r[0],s=r[1],i=Object(c.useState)((function(){return window.sessionStorage.getItem("token")})),l=Object(m.a)(i,2),u=l[0],d=l[1];return Object(c.useEffect)((function(){if(u){var e=f.a.decode(u);s({id:e.id,name:"".concat(e.name.firstName," ").concat(e.name.lastName),email:e.email,ext:e.ext,role:e.role,sessionId:e.sessionId})}}),[u]),Object(o.jsx)(h.Provider,{value:{token:u,setToken:d,user:a,setUser:s},children:t})},x=h;var O=n(173),v=n.n(O).a.connect(),g=Object(c.createContext)(),N=function(e){var t=e.children;return Object(o.jsx)(g.Provider,{value:{socket:v},children:t})},w=g,y=function(){var e=Object(c.useContext)(x),t=e.token,n=e.setToken,o=e.user,r=e.setUser,a=Object(c.useContext)(w).socket;return{isLogged:Boolean(t),login:function(e){(function(e){var t=e.email,n=e.password;return fetch("/api/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then((function(e){if(!e.ok)throw new Error("Response is NOT ok");return e.json()})).then((function(e){return e.token}))})({email:e.email,password:e.password}).then((function(e){window.sessionStorage.setItem("token",e),n(e)})).catch((function(e){window.sessionStorage.removeItem("token"),r({}),u.b.error("Nombre de usuario y/o contrase\xf1a invalidos."),console.log(e)}))},logout:function(){(function(e){return fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(!e.ok)throw new Error("Response is NOT ok");return e.json()}))})(t).then((function(){a.emit("leave","SIP/".concat(o.ext)),window.sessionStorage.removeItem("token"),r({}),n(null)})).catch((function(e){console.log(e)}))},user:o}},k=function(){var e=y(),t=e.isLogged,n=e.logout;return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{bg:"light",expand:"lg",children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsx)(d.a.Brand,{href:"/",children:Object(o.jsx)("img",{src:"line-logo.png",width:"48px",alt:"2call logo"})}),Object(o.jsx)(d.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(o.jsx)(d.a.Collapse,{id:"basic-navbar-nav",children:t&&Object(o.jsx)(j.a,{className:"ml-auto ",variant:"outline-success",onClick:n,children:"Salir"})})]})})})},L=n(10),E=n.n(L),S=n(19),C=n(34),T=function(){var e=Object(c.useState)(""),t=Object(m.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),s=Object(m.a)(a,2),i=s[0],u=s[1],d=y(),b=d.login,f=d.isLogged,h=Object(l.g)();Object(c.useEffect)((function(){f&&h.push("/")}),[f,h]);var p=function(){var e=Object(S.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),b({email:n,password:i});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.jsx)("div",{className:"container",children:Object(o.jsx)("div",{className:"mt-5 d-flex justify-content-center align-items-center",children:Object(o.jsxs)(C.a,{onSubmit:p,children:[Object(o.jsxs)(C.a.Group,{controlId:"formBasicEmail",children:[Object(o.jsx)(C.a.Label,{children:"Correo Electronico"}),Object(o.jsx)(C.a.Control,{type:"email",placeholder:"Ingresa tu correo...",onChange:function(e){return r(e.target.value)},value:n})]}),Object(o.jsxs)(C.a.Group,{controlId:"formBasicPassword",children:[Object(o.jsx)(C.a.Label,{children:"Contrase\xf1a"}),Object(o.jsx)(C.a.Control,{type:"password",placeholder:"Ingresa tu contrase\xf1a...",onChange:function(e){return u(e.target.value)},value:i})]}),Object(o.jsx)(j.a,{variant:"primary",type:"submit",block:!0,children:"Login"})]})})})},B=n(175),I=n(176);var R=function(e){var t=e.color;return Object(o.jsx)("svg",{height:21,viewBox:"0 0 21 21",width:21,xmlns:"http://www.w3.org/2000/svg",children:Object(o.jsx)("path",{d:"M5.5 11.5l3 3 8.028-8",fill:"none",stroke:t,strokeLinecap:"round",strokeLinejoin:"round"})})};var q=function(e){var t=e.color;return Object(o.jsx)("svg",{height:21,viewBox:"0 0 21 21",width:21,xmlns:"http://www.w3.org/2000/svg",children:Object(o.jsx)("g",{fill:"none",fillRule:"evenodd",stroke:t,strokeLinecap:"round",strokeLinejoin:"round",children:Object(o.jsx)("path",{d:"M5.5 15.5l10-10M15.5 15.5l-10-10z"})})})};var A=function(e){var t=e.color;return Object(o.jsx)("svg",{height:21,viewBox:"0 0 21 21",width:21,xmlns:"http://www.w3.org/2000/svg",children:Object(o.jsx)("g",{fill:"none",fillRule:"evenodd",stroke:t,strokeLinecap:"round",strokeLinejoin:"round",children:Object(o.jsx)("path",{d:"M15.585 15.5H5.415A1.65 1.65 0 014 13a10.526 10.526 0 001.5-5.415V6.5a4 4 0 014-4h2a4 4 0 014 4v1.085c0 1.907.518 3.78 1.5 5.415a1.65 1.65 0 01-1.415 2.5zM17.5 4.5c-.267-.934-.6-1.6-1-2-.4-.4-1.067-.733-2-1M3.588 4.5c.208-.933.512-1.6.912-2 .4-.4 1.095-.732 2.088-1M13 17c-.667 1-1.5 1.5-2.5 1.5S8.667 18 8 17"})})})};var M=function(e){var t=e.color;return Object(o.jsx)("svg",{height:21,viewBox:"0 0 21 21",width:21,xmlns:"http://www.w3.org/2000/svg",children:Object(o.jsx)("path",{d:"M3 10.5h2l2.5-6 2 12 3-9 2.095 6 1.405-3h2",fill:"none",stroke:t,strokeLinecap:"round",strokeLinejoin:"round"})})};var P=function(e){var t=e.color;return Object(o.jsx)("svg",{height:21,viewBox:"0 0 21 21",width:21,xmlns:"http://www.w3.org/2000/svg",children:Object(o.jsxs)("g",{fill:"none",fillRule:"evenodd",transform:"translate(2 2)",children:[Object(o.jsx)("circle",{cx:8.5,cy:8.5,r:8,stroke:t,strokeLinecap:"round",strokeLinejoin:"round"}),Object(o.jsx)("path",{d:"M8.5 9.5v-1l1.414-1.414a2 2 0 00.586-1.414V5.5c0-.613-.346-1.173-.894-1.447l-.212-.106a2 2 0 00-1.788 0L7.5 4c-.613.306-1 .933-1 1.618V6.5",stroke:t,strokeLinecap:"round",strokeLinejoin:"round"}),Object(o.jsx)("circle",{cx:8.5,cy:12.5,fill:t,r:1})]})})},F="InUse",D="Idle",U="Ringing",J="Unavailable",z=function(){var e,t,n,r,a,s,i,l,d,b,f,h=Object(c.useState)(!1),p=Object(m.a)(h,2),O=p[0],v=p[1],g=Object(c.useState)("default"),N=Object(m.a)(g,2),k=N[0],L=N[1],E=Object(I.a)(),S=E.register,C=E.errors,T=E.handleSubmit,z=E.setValue,V=E.reset,G=(E.formState.isDirty,Object(c.useRef)(null)),H=Object(c.useContext)(w).socket,K=Object(c.useContext)(x).token,Q=y().user,W=Object(c.useState)(null),X=Object(m.a)(W,2),Y=X[0],Z=X[1],$=Object(c.useState)("secondary"),_=Object(m.a)($,2),ee=_[0],te=_[1];Object(c.useEffect)((function(){(null===Q||void 0===Q?void 0:Q.ext)&&H.emit("join","SIP/".concat(Q.ext)),(null===Q||void 0===Q?void 0:Q.ext)&&H.emit("checkExtState",Q.ext)}),[Q,H]),Object(c.useEffect)((function(){console.log(O),!1===O&&(console.log("entro"),L("default"))}),[O]),Object(c.useEffect)((function(){H.on("checkedExtState",(function(e){Z(e),te(e===J?"danger":e===U?"warning":e===F?"primary":e===D?"success":"secondary")}))}),[H]),Object(c.useEffect)((function(){H.on("ExtStateChange",(function(e){Z(e),te(e===J?"danger":e===U?"warning":e===F?"primary":e===D?"success":"secondary")}))}),[H]),Object(c.useEffect)((function(){H.on("DialBegin",(function(e){var t,n,o="".concat(e.phone," ").concat(void 0===e.name?"":null===(t=e.name)||void 0===t?void 0:t.firstName," ").concat(void 0===e.name?"":null===(n=e.name)||void 0===n?void 0:n.lastName);G.current=u.b.dark(o)}))}),[H]),Object(c.useEffect)((function(){H.on("BridgeEnter",(function(e){z("phone",e.phone),z("rut",e.rut),z("firstName",e.name?e.name.firstName:""),z("lastName",e.name?e.name.lastName:""),u.b.dismiss(G.current)}))}),[H,z]),Object(c.useEffect)((function(){H.on("Hangup",(function(){u.b.dismiss(G.current)}))}),[H]);return Object(o.jsxs)("div",{className:"py-3",children:[Object(o.jsx)("div",{className:"container",children:Object(o.jsxs)("div",{className:"row justify-content-center justify-content-between px-3",children:[Object(o.jsx)("div",{className:"form-group m-0",children:Object(o.jsxs)(j.a,{variant:ee,className:"mb-3 mb-sm-0",block:!0,children:[Object(o.jsx)("span",{children:function(){switch(Y){case J:return Object(o.jsx)(q,{color:"#ffffff"});case U:return Object(o.jsx)(A,{color:"#000000"});case F:return Object(o.jsx)(M,{color:"#ffffff"});case D:return Object(o.jsx)(R,{color:"#ffffff"});default:return Object(o.jsx)(P,{color:"#ffffff"})}}()})," ",Q.name," | ",Q.ext]})}),Object(o.jsx)("div",{className:"form-group m-0",children:Object(o.jsxs)("div",{className:"input-group",children:[Object(o.jsxs)("select",{className:"custom-select",onChange:function(e){L(e.target.value)},disabled:O,value:k,children:[Object(o.jsx)("option",{value:"default",children:"Pausas..."}),Object(o.jsx)("option",{value:"break",children:"Descanso"}),Object(o.jsx)("option",{value:"bath",children:"Ba\xf1o"}),Object(o.jsx)("option",{value:"lunch",children:"Colacion"}),Object(o.jsx)("option",{value:"administrative",children:"Administrativo"}),Object(o.jsx)("option",{value:"supervisor",children:"Supervisor"}),Object(o.jsx)("option",{value:"meeting",children:"Reunion"}),Object(o.jsx)("option",{value:"maintenance",children:"Mantencion"})]}),Object(o.jsx)("div",{className:"input-group-append",children:Object(o.jsx)("button",{className:"btn btn-outline-secondary",type:"button",onClick:function(){v(!O);var e={pauseType:k,activateBreak:O};fetch("/api/users/break",{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(K)}}).then((function(e){return e.json()})).catch((function(e){return console.error("Error:",e)})).then((function(e){console.log("Success:",e)}))},disabled:"default"===k,children:O?"Desactivar":"Activar"})})]})})]})}),Object(o.jsx)("hr",{}),Object(o.jsx)("form",{onSubmit:T((function(e){fetch("/api/contacts",{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).catch((function(e){return console.error("Error:",e)})).then((function(e){e.error?u.b.error(e.error):(z("phone",e.phone),z("rut",e.rut),z("firstName",e.name.firstName),z("lastName",e.name.lastName),u.b.success("Datos de contacto guardado."))}))})),className:"container",children:Object(o.jsxs)("fieldset",{disabled:!!O,children:[Object(o.jsxs)("div",{className:"form-group",children:[Object(o.jsx)("label",{htmlFor:"rut",children:"RUT"}),Object(o.jsx)("input",{className:"form-control",type:"text",name:"rut",ref:S({required:!0,validate:{isRut:function(e){return Object(B.validate)(e)}}})}),Object(o.jsxs)("small",{className:"form-text text-muted",children:["required"===(null===(e=C.rut)||void 0===e?void 0:e.type)&&"El campo Rut es requerido.","isRut"===(null===(t=C.rut)||void 0===t?void 0:t.type)&&"El formato del campo Rut es invalido."]})]}),Object(o.jsxs)("div",{className:"form-group",children:[Object(o.jsx)("label",{htmlFor:"firstName",children:"Nombre"}),Object(o.jsx)("input",{className:"form-control",type:"text",name:"firstName",ref:S({required:!0,maxLength:15,minLength:3})}),Object(o.jsxs)("small",{className:"form-text text-muted",children:["required"===(null===(n=C.firstName)||void 0===n?void 0:n.type)&&"El campo Nombre  es requerido.","maxLength"===(null===(r=C.firstName)||void 0===r?void 0:r.type)&&"El maximo de catacteres para el campo Nombre es 15.","minLength"===(null===(a=C.firstName)||void 0===a?void 0:a.type)&&"El minimo de catacteres para el campo Nombre es 3."]})]}),Object(o.jsxs)("div",{className:"form-group",children:[Object(o.jsx)("label",{htmlFor:"lastName",children:"Apellido"}),Object(o.jsx)("input",{className:"form-control",type:"text",name:"lastName",ref:S({required:!0,maxLength:15,minLength:3})}),Object(o.jsxs)("small",{className:"form-text text-muted",children:["required"===(null===(s=C.lastName)||void 0===s?void 0:s.type)&&"El campo Apellido es requerido.","maxLength"===(null===(i=C.lastName)||void 0===i?void 0:i.type)&&"El maximo de catacteres para el campo Apellido es 15.","minLength"===(null===(l=C.lastName)||void 0===l?void 0:l.type)&&"El minimo de catacteres para el campo Apellido es 3."]})]}),Object(o.jsxs)("div",{className:"form-group",children:[Object(o.jsx)("label",{htmlFor:"phone",children:"Telefono"}),Object(o.jsx)("input",{className:"form-control",type:"text",name:"phone",ref:S({required:!0,maxLength:9,minLength:9})}),Object(o.jsxs)("small",{className:"form-text text-muted",children:["required"===(null===(d=C.phone)||void 0===d?void 0:d.type)&&"El campo Telefono  es requerido.","maxLength"===(null===(b=C.phone)||void 0===b?void 0:b.type)&&"El maximo de catacteres para el campo Telefono es 9.","minLength"===(null===(f=C.phone)||void 0===f?void 0:f.type)&&"El minimo de catacteres para el campo Telefono es 9."]})]}),Object(o.jsx)(j.a,{type:"submit",variant:"outline-primary",className:"mr-2",children:"Guardar"}),Object(o.jsx)(j.a,{type:"button",variant:"outline-secondary",onClick:function(){V()},children:"Limpiar"})]})})]})},V=function(){return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)("div",{className:"container",children:[Object(o.jsx)("h1",{children:"Pagina no encontrada"}),Object(o.jsx)(i.b,{className:"btn btn-info",to:"/",children:"Ir Al inicio"})]})})},G=n(66),H=n(177),K=function(e){var t=e.component,n=Object(H.a)(e,["component"]),c=y().isLogged;return Object(o.jsx)(l.b,Object(G.a)(Object(G.a)({},n),{},{render:function(e){return Boolean(c)?Object(o.jsx)(t,Object(G.a)({},e)):Object(o.jsx)(l.a,{to:"/login"})}}))},Q=(n(322),n(323),function(){return Object(o.jsx)(p,{children:Object(o.jsx)(N,{children:Object(o.jsxs)(i.a,{children:[Object(o.jsx)(u.a,{position:"top-right",autoClose:!1,newestOnTop:!1,closeOnClick:!1,rtl:!1,pauseOnFocusLoss:!1,draggable:!1}),Object(o.jsx)(k,{}),Object(o.jsxs)(l.d,{children:[Object(o.jsx)(K,{exact:!0,path:"/",component:z}),Object(o.jsx)(l.b,{exact:!0,path:"/login",component:T}),Object(o.jsx)(l.b,{component:V})]})]})})})});s.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(Q,{})}),document.getElementById("root"))}},[[324,1,2]]]);
//# sourceMappingURL=main.28a9adc7.chunk.js.map